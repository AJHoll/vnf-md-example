# Быстрый старт

## Клонирование репозитария

Для просмотра вам понадоибтся репозитарий - скачайте его удобным для вас способом, если у вас установлен Git, то действие выполняется простым скриптом

```bash
git clone https://github.com/AJHoll/vnf-md-example.git
```

## Разворачивание базы

Для разворачивания базы вам понадобится установленный PostgresPro версии 12 или выше.
Дамп создан на версии 12.5 и точно работает на нем.

Проверить можно, выполнив простой скрипт:

```bash
@ psql --version

# ответ: psql (PostgreSQL) 12.5
```

Если у вас его нет - то пройдя по ссылке можно скачать с официального сайта компании Postgres Professional.

[https://www.postgrespro.ru/#order](https://www.postgrespro.ru/#order)

Есть вероятность, что развернется и на более ранних версиях Postgres, но данный момент не проверялся.

Первое, что следует сделать - это выполнить на кластере файл со скриптом **_before_restore.sql_**

Он создаст в базе две роли для дальнейшей работы базы:

- uni_user
- uni_admin

Далее, вам следует воспользоваться файлом **_restore.cmd_**

Для правильного развертывания требуется изменить следующие переменные:

- **file_path** - путь к файлу с дампом (по-умолчанию он заберет файл #000_last_dump.tar из директории ./dumps)
- **host** - хост вашего кластера PostgresPro (по-умолчанию localhost)
- **port** - порт вашего кластера PostgresPro (по-умолчанию 5432)
- **username** - пользователь из под кого будет установлена разворачиваемая база

```bat
@echo off

set file_path=./dumps
set host=127.0.0.1
set port=5432
set username=sys

pg_restore -v -c -C -h %host% -p %port% -U %username% -W -d postgres %file_path%\#000_last_dump.tar
```

После изменения файла **_restore.cmd_** его следует запустить - ввести в консоли пароль и подождать, пока psql развернет базу.

По завершению его работы в кластере появится база с наименованием **_vnf-md-db_**

База построена в соответствии стандарту uni_dev_standart.

Для понимания стандарта, его можно посмотреть в корне данного репозитария.
Файл **dev_uni_standart.doc**

## Запуск REST API

Перед запуском API вам понадобится NodeJS

Скачать ее можно с официального сайта NodeJS

[https://nodejs.org/ru/](https://nodejs.org/ru/)

Для запуска API вам понадобится

Скачайте релиз:

https://github.com/AJHoll/vnf-md-example/releases/tag/thin

После чего распакуйте его в удобное для вас место.
Для запуска сервера требуется изменить ряд переменных среды, для чего ищем в каталоге ./api **_.env_**

Он содержит в себе ряд переменных:

- **DB_HOST** - Хост вашего кластера PostgresPro
- **DB_PORT** - Порт вашего кластера PostgresPro
- **DB_USER** - Имя пользователя кластера PostgresPro
- **DB_PASS** - Пароль пользователя кластера PostgresPro
- **DB_DATABASE** - База данных
- **REST_PORT** - Порт, на котором запускается REST API

```ts
DB_HOST = "localhost";
DB_PORT = 5432;
DB_USER = "";
DB_PASS = "";
DB_DATABASE = "vnf-md-db";
REST_PORT = 8080;
```

Измените файл, чтобы он содержал в себе нужную информацию для подключения.

и выполните файл **run-api.cmd**

В ответ в консоли должен запуститься и поддерживаться сервер

## Развертывание тонкого клиента

Для развертывания тонкого клиента просто запустите в корне файл **run-thin-client.cmd**

Если вы не меняли конфигурацию nginx в nginx.conf, то при входа на url: [http://localhost:8888](http://localhost:8888)
вы увидите тонкий клиент

Если вы меняли порт в конфигурации REST API (параметр REST_PORT), то зайдите в конфигурацию nginx.conf
./conf/nginx.conf

и в строке

```conf
proxy_pass http://localhost:8080;
```

поменяйте порт на тот, который вы указали в файле .env в api.
